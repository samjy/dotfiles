#!/bin/sh

xrandr --auto

# detect screens and resolution, we assume external will be HDMI
internal=$(xrandr | grep "^[^H].* connected " | awk '{ print$1 }')
internalresolution=$(xrandr | grep " connected " | grep "$internal" | grep -Po "\d+x\d+")
external=$(xrandr | grep "^H.* connected " | awk '{ print$1 }')
externalresolution=$(xrandr | grep " connected "| grep "$external" | grep -Po "\d+x\d+" )

echo "internal: $internal $internalresolution // external: $external $externalresolution"

# TODO allow to give externalresolution by hand (sometimes it's not on the line, e.g. when --off was called)
# TODO when screen is off, resolution doesn't get parsed.


case $1 in
	"")
		echo "$0 same|right|left|top|off [presentation]"
		xrandr
		exit 1
		;;
	"off")
		echo "Turning extra screen off"
		# make the internal output the primary
		xrandr --output $internal --primary
		# reset internal output position
		xrandr --output $internal --pos 0x0
		case $external in
			"")
				echo "no external screen"
				;;
			*)
                # turn screen off
                xrandr --output $external --off
				;;
        esac
		exit 0
		;;
	"same")
		echo "setting to same"
		xrandr --output $external --same-as $internal --mode $externalresolution --scale 1x1
		;;
	"right")
		echo "setting to right"
		xrandr --output $external --mode $externalresolution --right-of $internal
		;;
	"left")
		echo "setting to left"
		xrandr --output $external --mode $externalresolution --left-of $internal
		;;
	"leftvert")
		echo "setting to left vertical"
		xrandr --output $external --rotate right --mode $externalresolution --pos 0x0
		xrandr --output $internal --pos ${externalresolution##*x}x0
		;;
	"top")
		echo "setting to top"
		xrandr --output $external --mode $externalresolution --pos 0x0
		xrandr --output $internal --pos 0x${externalresolution##*x}
		;;
esac

case $2 in
	"")
		echo "with external screen as primary"
		echo "(for presentations, add 'presentation' to the command)"
		xrandr --output $external --primary
		;;
	"presentation")
		echo "with internal screen as primary (good for presentations)"
		xrandr --output $internal --primary
		;;
esac
